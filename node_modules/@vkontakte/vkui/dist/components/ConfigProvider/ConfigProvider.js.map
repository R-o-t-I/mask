{"version":3,"sources":["../../../src/components/ConfigProvider/ConfigProvider.tsx"],"names":["React","vkBridge","canUseDOM","useDOM","ConfigProviderContext","WebviewType","useIsomorphicLayoutEffect","useObjectMemo","noop","warnOnce","normalizeScheme","Scheme","AppearanceProvider","generateVKUITokensClassName","platform","resolvePlatform","warn","useSchemeDetector","node","_scheme","inherit","getScheme","useCallback","undefined","getAttribute","useState","resolvedScheme","setScheme","useEffect","observer","MutationObserver","observe","attributes","attributeFilter","disconnect","deriveAppearance","scheme","SPACE_GRAY","VKCOM_DARK","ConfigProvider","children","webviewType","VKAPPS","isWebView","transitionMotionEnabled","hasNewTokens","appearance","normalizedScheme","document","target","body","process","env","NODE_ENV","hasAttribute","setAttribute","removeAttribute","realScheme","derivedAppearance","VKUITokensClassName","classList","add","remove","configContext"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport vkBridge, { AppearanceType } from \"@vkontakte/vk-bridge\";\nimport { canUseDOM, useDOM } from \"../../lib/dom\";\nimport {\n  ConfigProviderContext,\n  ConfigProviderContextInterface,\n  WebviewType,\n} from \"./ConfigProviderContext\";\nimport { useIsomorphicLayoutEffect } from \"../../lib/useIsomorphicLayoutEffect\";\nimport { useObjectMemo } from \"../../hooks/useObjectMemo\";\nimport { noop } from \"../../lib/utils\";\nimport { warnOnce } from \"../../lib/warnOnce\";\nimport {\n  normalizeScheme,\n  AppearanceScheme,\n  Scheme,\n} from \"../../helpers/scheme\";\nimport {\n  AppearanceProvider,\n  generateVKUITokensClassName,\n} from \"../AppearanceProvider/AppearanceProvider\";\nimport { platform as resolvePlatform } from \"../../lib/platform\";\n\nexport interface ConfigProviderProps\n  extends Partial<ConfigProviderContextInterface> {\n  /**\n   * @deprecated будет удалено в 5.0.0, устанавливать тему следует через appearance\n   * Цветовая схема приложения\n   */\n  scheme?: AppearanceScheme;\n}\n\nconst warn = warnOnce(\"ConfigProvider\");\n\nfunction useSchemeDetector(\n  node: HTMLElement | undefined | null,\n  _scheme: Scheme | \"inherit\"\n) {\n  const inherit = _scheme === \"inherit\";\n  const getScheme = React.useCallback(() => {\n    if (!inherit || !canUseDOM || !node) {\n      return undefined;\n    }\n    return node.getAttribute(\"scheme\") as Scheme;\n  }, [inherit, node]);\n  const [resolvedScheme, setScheme] = React.useState(getScheme());\n\n  React.useEffect(() => {\n    if (!inherit || !node) {\n      return noop;\n    }\n    setScheme(getScheme());\n    const observer = new MutationObserver(() => setScheme(getScheme()));\n    observer.observe(node, { attributes: true, attributeFilter: [\"scheme\"] });\n    return () => observer.disconnect();\n  }, [getScheme, inherit, node]);\n\n  return _scheme === \"inherit\" ? resolvedScheme : _scheme;\n}\n\nconst deriveAppearance = (scheme: Scheme | undefined): AppearanceType =>\n  scheme === Scheme.SPACE_GRAY || scheme === Scheme.VKCOM_DARK\n    ? \"dark\"\n    : \"light\";\n\nconst ConfigProvider: React.FC<ConfigProviderProps> = ({\n  children,\n  webviewType = WebviewType.VKAPPS,\n  isWebView = vkBridge.isWebView(),\n  transitionMotionEnabled = true,\n  platform = resolvePlatform(),\n  hasNewTokens = false,\n  appearance,\n  scheme,\n}) => {\n  const normalizedScheme = normalizeScheme({\n    scheme,\n    platform,\n    appearance,\n  });\n  const { document } = useDOM();\n  const target = document?.body;\n\n  useIsomorphicLayoutEffect(() => {\n    if (normalizedScheme === \"inherit\") {\n      return noop;\n    }\n    if (\n      process.env.NODE_ENV === \"development\" &&\n      target?.hasAttribute(\"scheme\")\n    ) {\n      warn(\n        '<body scheme> was set before VKUI mount - did you forget scheme=\"inherit\"?'\n      );\n    }\n    target?.setAttribute(\"scheme\", normalizedScheme);\n    return () => target?.removeAttribute(\"scheme\");\n  }, [normalizedScheme]);\n\n  const realScheme = useSchemeDetector(target, normalizedScheme);\n  const derivedAppearance = deriveAppearance(realScheme);\n\n  useIsomorphicLayoutEffect(() => {\n    const VKUITokensClassName = generateVKUITokensClassName(\n      platform,\n      derivedAppearance\n    );\n\n    target?.classList.add(VKUITokensClassName);\n\n    return () => {\n      target?.classList.remove(VKUITokensClassName);\n    };\n  }, [platform, derivedAppearance]);\n\n  const configContext = useObjectMemo({\n    webviewType,\n    isWebView,\n    transitionMotionEnabled,\n    hasNewTokens,\n    platform,\n    scheme,\n    appearance: appearance || derivedAppearance,\n  });\n\n  return (\n    <ConfigProviderContext.Provider value={configContext}>\n      <AppearanceProvider appearance={configContext.appearance}>\n        {children}\n      </AppearanceProvider>\n    </ConfigProviderContext.Provider>\n  );\n};\n\n// eslint-disable-next-line import/no-default-export\nexport default ConfigProvider;\n"],"file":"ConfigProvider.js"}